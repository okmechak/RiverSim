<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>RiverSim: Testing Program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">RiverSim
   &#160;<span id="projectnumber">2.4.2</span>
   </div>
   <div id="projectbrief">River Simulation Program</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="research.html">Numerical Research</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Testing Program </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#intro">Introduction</a></li>
<li class="level1"><a href="#parlookscript">Parameter Lookup Script.</a><ul><li class="level2"><a href="#freefemmathematicariversim">Comparison with Mathematica and FreeFem</a><ul><li class="level3"><a href="#freefemtest">FreeFem++ Test Program</a></li>
<li class="level3"><a href="#mathematicatest">Mathematica Test Program</a><ul><li class="level4"><a href="#mathmeshreftest">Mesh Refinment Function research</a></li>
</ul>
</li>
<li class="level3"><a href="#mathematicanumparams">Wolfram Mathematica Numerical Method Parameters</a><ul><li class="level4"><a href="#mathnumpar">NItegrate, NDSolve</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="intro"></a>
Introduction</h1>
<p>As it appearred, writing a simulation program is only first half of solution. Next is testing, parameter adjustment, running simulations, processing of results, making conclussions etc.</p>
<p>This section is dedicated to <b>parameter adjustment</b> and <b>testing</b>.</p>
<h1><a class="anchor" id="parlookscript"></a>
Parameter Lookup Script.</h1>
<p>RiverSim program can accomplish two main things:</p>
<ul>
<li>Generate river network based on intial conditions(see <a class="el" href="io_8hpp.html">io.hpp</a>).</li>
<li>Backward river evoltuion used in one of methods to calculate river parameters.</li>
</ul>
<p>These options are controled by program option &ndash;simulation-type(or -t, see ./riversim -h for details).</p>
<ul>
<li>Also it has third mode - used for testing and development purposes.</li>
</ul>
<p>RiverSim program has a lot of parameters and a lot of them impact accuracy of results, but also time of calculations. To figure out "optimal" parameters is hard.</p>
<p>For this purpose was created shell script: <code>parameter_lookup.sh</code>. It itterates over some most important parameters for accuracy in the third "development" mode of program. Also it runs in each program in parallel, this feature drastically improves perfomance. Also <code>parameter_lookup.sh</code> can be used as example for writing other scripts.</p>
<p><a href="parameter_lookup.sh">source code of parameter_lookup.sh</a></p>
<dl class="section note"><dt>Note</dt><dd>on some systems default location of bash is different from <code>#!/bin/bash</code></dd></dl>
<h2><a class="anchor" id="freefemmathematicariversim"></a>
Comparison with Mathematica and FreeFem</h2>
<h3><a class="anchor" id="freefemtest"></a>
FreeFem++ Test Program</h3>
<p><a href="test.edp">FreeFem source code</a></p>
<p><b>Illustratrion steps of how freefem++ test program works</b>:</p>
<table style="width:100%">
<tr>
<th>Boundaries setup  </th><th>Mesh generation  </th><th>Adaptive mesh  </th><th>Solution  </th><th>Integration around tips   </th></tr>
<tr>
<th> <style>div.image img[src="FreeFemBoundary.jpg"]{     height:100%;width:100%;}</style> <div class="image">
<img src="FreeFemBoundary.jpg" alt="FreeFemBoundary.jpg"/>
</div>
  </th><th> <style>div.image img[src="FreeFemMesh.jpg"]{         height:100%;width:100%;}</style> <div class="image">
<img src="FreeFemMesh.jpg" alt="FreeFemMesh.jpg"/>
</div>
  </th><th> <style>div.image img[src="FreeFemAdaptiveMesh.jpg"]{ height:100%;width:100%;}</style> <div class="image">
<img src="FreeFemAdaptiveMesh.jpg" alt="FreeFemAdaptiveMesh.jpg"/>
</div>
  </th><th> <style>div.image img[src="FreeFemSolution.jpg"]{     height:100%;width:100%;}</style> <div class="image">
<img src="FreeFemSolution.jpg" alt="FreeFemSolution.jpg"/>
</div>
  </th><th> <style>div.image img[src="FreeFemTipMesh.jpg"]{      height:100%;width:100%;}</style> <div class="image">
<img src="FreeFemTipMesh.jpg" alt="FreeFemTipMesh.jpg"/>
</div>
   </th></tr>
</table>
<p><b>Test values:</b></p>
<ul>
<li>series params<ul>
<li>a1 = <b>0.1018660081624733</b></li>
<li>a2 = <b>0.04546179329449326</b></li>
<li>a3 = <b>0.1308697639326795</b></li>
</ul>
</li>
<li>integral over whole region: <b>0.03420196874531437</b></li>
<li>integration over tip circle <b>0.0004613243016595069</b></li>
</ul>
<h3><a class="anchor" id="mathematicatest"></a>
Mathematica Test Program</h3>
<p>This script implements same solution to FreeFem++ but in high level language Wolfram Mathematica.</p>
<p><a href="RectangularRegionTest.nb">Mathemamtica program source code</a></p>
<center> <table style="width:70%">
<tr>
<th>Boundaries setup  </th><th>Refined mesh  </th><th>Solution   </th></tr>
<tr>
<th> <style>div.image img[src="MathematicaBoundary.jpg"]{     height:100%;width:100%;}</style> <div class="image">
<img src="MathematicaBoundary.jpg" alt="MathematicaBoundary.jpg"/>
</div>
  </th><th> <style>div.image img[src="MathematicaMesh.jpg"]{     height:100%;width:100%;}</style> <div class="image">
<img src="MathematicaMesh.jpg" alt="MathematicaMesh.jpg"/>
</div>
  </th><th> <style>div.image img[src="MathematicaSolution.jpg"]{     height:100%;width:100%;}</style> <div class="image">
<img src="MathematicaSolution.jpg" alt="MathematicaSolution.jpg"/>
</div>
   </th></tr>
</table>
</center><p><b>Test values:</b></p>
<ul>
<li>series params<ul>
<li>a1 =</li>
<li>a2 =</li>
<li>a3 =</li>
</ul>
</li>
<li>integral over whole region:</li>
<li>integration over tip circle:</li>
<li>maximal value:</li>
</ul>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000017">Todo:</a></b></dt><dd>evaluate series params and target values in matheamtica</dd></dl>
<h4><a class="anchor" id="mathmeshreftest"></a>
Mesh Refinment Function research</h4>
<p>Solving FEM is a lot about finding of golden ration, some optimal parameter values. On one side we have precission, and on the other - time. One of the biggest impact, on solution, is done by mesh. Program uses FEM which needs meshing of region, and there are regions where solution changes slowly(centrum), and very fast - around tips. So the problem is to find some mesh configuration, which will fit solution with less number of elements.</p>
<p>FreeFem solution already uses function which constrains element size, in such way that mesh is smallest at tip, and gets coarser far away from tip. Currently FreeFem and riversim uses next heuristic function, to constrain size of mesh element: </p><p class="formulaDsp">
\[ \frac{\beta}{\alpha+exp(-\frac{r}{r_0})} \]
</p>
<p> where, \(\beta, \alpha, r_0\) - parameters, and \(r\) - distance to tip point. But how about all other possible types of function, like these: </p><p class="formulaDsp">
\[ const \\ \alpha r \\ \alpha r^n \\ E^r \]
</p>
<p> Does they give better solution with less resources? Lets find out.</p>
<p> <style>div.image img[src="MeshConstraintFunctions.jpg"]{       height:50%;width:50%;}</style> </p><div class="image">
<img src="MeshConstraintFunctions.jpg" alt="MeshConstraintFunctions.jpg"/>
<div class="caption">
Mesh constraint test functions</div></div>
<p> <style>div.image img[src="MeshGenerationTime.jpg"]{            height:50%;width:50%;}</style> </p><div class="image">
<img src="MeshGenerationTime.jpg" alt="MeshGenerationTime.jpg"/>
<div class="caption">
Mesh generation time(s) as function of mesh elements number</div></div>
<p> <style>div.image img[src="SolutionTime.jpg"]{                  height:50%;width:50%;}</style> </p><div class="image">
<img src="SolutionTime.jpg" alt="SolutionTime.jpg"/>
<div class="caption">
PDE soltuion time as function of mesh elements number</div></div>
<p> Next plots show value of integral over whole rectangular region \(\oint solution(x,y) dx dy\):</p>
<center> <table style="width:70%">
<tr>
<th>All test functions  </th><th>Without the worst one   </th></tr>
<tr>
<th> <style>div.image img[src="WholeRegionConvergence.jpg"]{        height:100%;width:100%;}</style> <div class="image">
<img src="WholeRegionConvergence.jpg" alt="WholeRegionConvergence.jpg"/>
<div class="caption">
Integral value as function of mesh elements number</div></div>
  </th><th> <style>div.image img[src="WholeRegionConvergenceDropped.jpg"]{ height:100%;width:100%;}</style> <div class="image">
<img src="WholeRegionConvergenceDropped.jpg" alt="WholeRegionConvergenceDropped.jpg"/>
<div class="caption">
Integral value as function of mesh elements number</div></div>
   </th></tr>
</table>
</center><p>From these plots can be seen that \(\alpha\sqrt{r}\) converge fastest. But if we will consider another target value instead of whole region integral, like integral over circular region aroud tip(which is very important to series parameters calculation) \(\oint_{|(x,y)-\vec{R_{tip}}|&lt;r_0}^{ }solution(x,y)dxdy\), then convergence plot will look like this:</p>
<p> <style>div.image img[src="TipIntegralConvergenceDropped.jpg"]{      height:50%;width:50%;}</style> </p><div class="image">
<img src="TipIntegralConvergenceDropped.jpg" alt="TipIntegralConvergenceDropped.jpg"/>
<div class="caption">
Mesh generation time(s)</div></div>
<p> Now best mesh constraint area function is \(\alpha r^{3/2}\), which is worst in previous case of whole region integral.</p>
<p>Results are contradictive and trivial, becouse in case of whole region integral \(\alpha \sqrt{r}\) gives small mesh elements on whole region. In case of tip integral \(\alpha r^{3/2}\) - gives small elements near tip.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000018">Todo:</a></b></dt><dd>Create new target value, which will better judge mesh constraint funcitons. </dd></dl>
<h3><a class="anchor" id="mathematicanumparams"></a>
Wolfram Mathematica Numerical Method Parameters</h3>
<h4><a class="anchor" id="mathnumpar"></a>
NItegrate, NDSolve</h4>
<p>Wolfram Mathematica provides a lot of builtin numerical functions. Some functions encapsulates a lot of functionality inside, which are controlled by parameters. For example <b>NItegrate</b> and <b>NDSolve</b>, which are used for solving PDE and evaluation of series parameters, dependce on few very important parameters: <b>AccuracyGoal</b> and <b>PrecisionGoal</b>. These parameters have big inpact on precision but also on evalution time. The question is straightforward - what are the optimal values for them?</p>
<dl class="section note"><dt>Note</dt><dd>Also there are <b>MaxRecursion</b> and <b>WorkingPrecision</b> parameters, but testing these parameters didn't show significant impact on precision.</dd></dl>
<p> <style>div.image img[src="PrecisionAndAccuracyIntegration.jpg"]{ height:50%;width:50%;}</style> </p><div class="image">
<img src="PrecisionAndAccuracyIntegration.jpg" alt="PrecisionAndAccuracyIntegration.jpg"/>
<div class="caption">
Plot of result convergence and time of evalution as function of AccuracyGoal and PrecisionGoal</div></div>
<p> As can be seen from plots values AccuracyGoal ~= 5 and PrecisionGoal ~= 6 gives good precision in small evaluation time. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
